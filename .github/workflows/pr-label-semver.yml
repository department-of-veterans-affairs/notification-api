name: CD Pipeline PR Labels and Semver bump Summary

on: 
  workflow_call:
  push: 
    branches:
      - 1727-HOTFIX

jobs:
  # check-pr-sem:
    # runs-on: ubuntu-latest
    # permissions:
      # contents: write
    # steps:
      # - uses: actions/checkout@v4
      # - name: PR Label Semver
        # uses: actions/github-script@v7
        # with:
          # github-token: ${{ secrets.VAR_PAT }}
          # script: |
            # const path = '.github/scripts/prLabelSemver.js';
            # const prLabelSemver = require(path);
            # prLabelSemver({github, context, core});

  test-merge-workflow-to-a-branch:
    # These permissions are needed to write to the release branch
    permissions:
      contents: write
    runs-on: ubuntu-latest
    steps:
      - name: Checkout release branch
        uses: actions/checkout@v4
        with:
          # ref: release
          ref: 1727-hotfix-pat-test
          fetch-depth: 0
          # Fine-grained PAT with contents:write and workflows:write
          # scopes
          token: ${{ secrets.CD_PAT }}

      - name: Setup git user
        # The following is taken from https://github.com/actions/checkout/issues/13 as a common work-around
        run: |
            git config --global user.name "$(git --no-pager log --format=format:'%an' -n 1)"
            git config --global user.email "$(git --no-pager log --format=format:'%ae' -n 1)"
          
      - name: Merge commit SHA to release
        run: |
          git merge ${{ github.sha }} --no-squash -X theirs
          git push

